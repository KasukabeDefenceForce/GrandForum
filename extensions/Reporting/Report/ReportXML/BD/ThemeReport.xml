<?xml version="1.0" encoding="UTF-8" ?>
<Report name="Theme Report" reportType="RP_THEME_REPORT_{GET(id)}" pdfType="RP_THEME_REPORT_{GET(id)}" pdfFiles="ThemeReportPDF" year="0" personId="0" ajax="true" disabled="false">
    <Permissions>
        <Role role="Staff+">
            <SectionPermission id="report" permissions="rw" />
            <SectionPermission id="submit" permissions="rw" />
        </Role>
        <Role role="TL">
            <SectionPermission id="report" permissions="rw" />
            <SectionPermission id="submit" permissions="rw" />
        </Role>
        <Theme />
        <If if="{!matches({GET(id)},^[0-9][0-9][0-9][0-9]_Q[1-4])}">
            <SectionPermission id="report" permissions="--" />
            <SectionPermission id="submit" permissions="--" />
        </If>
    </Permissions>
    <ReportSection id="report" type="EditableReportSection" name="Theme Report" title="{$theme_name}">
        <!-- Variables -->
        <Static>
            {set(year,    {substr({GET(id)}, 0, 4)})}
            {set(quarter, {substr({GET(id)}, 6, 1)})}
        </Static>
        <If if="{==({get(quarter)},1)}">
            <![CDATA[
                <h3>{get(year)}:Q{get(quarter)} Report - Submit by: April 15, {get(year)}</h3>
            ]]>
        </If>
        <ElseIf if="{==({get(quarter)},2)}">
            <![CDATA[
                <h3>{get(year)}:Q{get(quarter)} Report - Submit by: July 15, {get(year)}</h3>
            ]]>
        </ElseIf>
        <ElseIf if="{==({get(quarter)},3)}">
            <![CDATA[
                <h3>{get(year)}:Q{get(quarter)} Report - Submit by: Oct 15, {get(year)}</h3>
            ]]>
        </ElseIf>
        <ElseIf if="{==({get(quarter)},4)}">
            <![CDATA[
                <h3>{get(year)}:Q{get(quarter)} Report - Submit by: Jan 15, {add({get(year)},1)}</h3>
            ]]>
        </ElseIf>
        
        <!-- Past Reports -->
        <Static>
            {set(startYear, {timestamp(Y-m-d)})}
        </Static>
        <ReportItemSet type="ThemeProjects" all="true">
            <Static>
                {set(startYear, {min({get(startYear)},{substr({$project_start},0,4)})} )}
            </Static>
        </ReportItemSet>
        <Static>
            <![CDATA[
                <div class="pdfnodisplay">
                <h3>Past Reports</h3>
                <table id='past' class="wikitable">
                    <tr>
                        <th rowspan='2'>Project</th>
            ]]>
        </Static>
        <!-- Year Header -->
        <For from="{get(startYear)}" to="{timestamp(Y)}">
            <Static>
                <![CDATA[
                    <th colspan='4'>{$getExtra}</th>
                ]]>
            </Static>
        </For>
        <Static>
            <![CDATA[
                    </tr>
                    <tr>
            ]]>
        </Static>
        <!-- Quarter Header -->
        <For from="{get(startYear)}" to="{timestamp(Y)}">
            <Static>
                <![CDATA[
                    {set(y, {$getExtra})}
                ]]>
            </Static>
            <For from="1" to="4">
                <Static>
                    <![CDATA[
                        {set(q, {$getExtra})}
                        <th>Q{get(q)}</th>
                    ]]>
                </Static>
            </For>
        </For>
        <Static>
            <![CDATA[
                    </tr>
            ]]>
        </Static>
        <!-- PDF Rows -->
        <ReportItemSet type="ThemeProjects" all="true">
            <Static>
                <![CDATA[
                    <tr class="project">
                        <td><b>{$project_name}</b></td>
                ]]>
            </Static>
            <For from="{get(startYear)}" to="{timestamp(Y)}">
                <Static>
                    <![CDATA[
                        {set(y, {$getExtra})}
                    ]]>
                </Static>
                <For from="1" to="4">
                    <Static>
                        <![CDATA[
                            {set(q, {$getExtra})}
                        ]]>
                    </Static>
                    <ReportItem id="pdf" type="PDFReportItem" buttonName="&lt;img src='{$wgServer}{$wgScriptPath}/skins/pdf.gif' />" class="" project="true" reportType="ProjectReportPDF" pdfType="RP_PROJECT_REPORT_{get(y)}_Q{get(q)}" year="0" showWord="true">
                        <![CDATA[
                            <td style='padding-left:0.5em; padding-right:0.5em;'>{$item}</td>
                        ]]>
                    </ReportItem>
                </For>
            </For>
            <Static>
                <![CDATA[
                    </tr>
                ]]>
            </Static>
        </ReportItemSet>
        <Static>
            <![CDATA[
                <tr>
                    <th style='text-align:left;'>Merged</th>
            ]]>
        </Static>
        <For from="{get(startYear)}" to="{timestamp(Y)}">
            <For from="1" to="4">
                <Static>
                    <![CDATA[
                        <th>
                            <a class='merged pdf' style="width:auto;" href="#"><img src="{$wgServer}{$wgScriptPath}/skins/pdf.gif"></a>
                            <a class='merged doc' style="width:auto;" href="#"><img src="{$wgServer}{$wgScriptPath}/skins/word.gif"></a>
                        </th>
                    ]]>
                </Static>
            </For>
        </For>
        <Static>
            <![CDATA[
                    </tr>
                </table>
                </div>
                <script type='text/javascript'>
                    $('.merged.pdf').each(function(i, el){
                        var id = i+1;
                        var pdfs = [];
                        $('#past tr.project').each(function(i, el){
                            $("a.pdf", $('td', $(el)).eq(id)).each(function(j, a){
                                var href = $(a).attr("href").split("?getpdf=");
                                pdfs.push(href[1]);
                            });
                        });
                        if(pdfs.length > 0){
                            var urlPdf = wgServer + wgScriptPath + "/index.php/Special:ReportArchive?merge=" + pdfs.join(",") + "&cover&generatePDF&headerName={$theme_name}";
                            var urlDoc = urlPdf + "&doc";
                            $(el).attr("href", urlPdf);
                            $(el).next().attr("href", urlDoc);
                        }
                        else{
                            $(el).hide();
                            $(el).next().hide();
                        }
                    });
                </script>
            ]]>
        </Static>
        
        <!-- Start the Report -->
        <ReportItem id="description" type="Textarea" blobItem="DESCRIPTION" rich="true">
            <![CDATA[
                <h3>1. Description of theme work</h3>
                <p>General description of the activities performed in the past 3 months in relation to the overall goals, objectives, and timelines of the theme.</p>
                {$item}
            ]]>
        </ReportItem>
        <ReportItem id="milestones" type="Textarea" blobItem="MILESTONES" rich="true">
            <![CDATA[
                <h3>2. Summary of theme activities and milestones</h3>
                <p>Explain the research progress made during the past 3 months, mentioning any notable administrative or research outcome.</p>
                {$item}
            ]]>
        </ReportItem>
        <ReportItem id="edi" type="Textarea" blobItem="EDI" rich="true">
            <![CDATA[
                <h3>3. Theme summary update on equity diversity and inclusion</h3>
                <p>Explain how EDI considerations have been incorporated in your work, including the design and implementation of your research activities, the composition of theme teams, formation, and training of HQPs, participation in EDI events, etc.</p>
                <b><a href='#' onClick='$("#surveyStats").slideToggle();'>Toggle Survey Stats</a></b>
                <div id='surveyStats' style='display:none;'>
                    {$themeSurveyStats}
                </div>
                {$item}
            ]]>
        </ReportItem>
        <ReportItem id="challenges" type="Textarea" blobItem="CHALLENGES" rich="true">
            <![CDATA[
                <h3>4. Identified of anticipated theme challenges</h3>
                <p>Explain any challenges or concerns that have been identified during the past 3 months, including anticipated ones. If possible, explain how you have or are planning to address them.</p>
                {$item}
            ]]>
        </ReportItem>
        <ReportItem id="adjustments" type="Textarea" blobItem="ADJUSTMENTS" rich="true">
            <![CDATA[
                <h3>5. Summary of theme milestone adjustments</h3>
                <p>Have you modified your theme milestones because of activities/ challenges youâ€™ve encountered in the past 3 months? If so, provide a brief description of the changes and the rationale that supports them.</p>
                {$item}
            ]]>
        </ReportItem>
        <ReportItem id="nextsteps" type="Textarea" blobItem="NEXTSTEPS" rich="true">
            <![CDATA[
                <h3>6. Theme next steps</h3>
                <p>Briefly explain next steps including expected outcomes, activities, and objectives for the next 3 months.</p>
                {$item}
            ]]>
        </ReportItem>
        <ReportItem id="comments" type="Textarea" blobItem="COMMENTS" rich="true">
            <![CDATA[
                <h3>7. Any other theme summary comments not captured above</h3>
                {$item}
            ]]>
        </ReportItem>
    </ReportSection>
    <ReportSection id="submit" tooltip="PDF generation and submission" name="Submit" blobSection="SEC_NONE" type="ReportSection" renderpdf="false">
        <ReportItem id="review" type="SimpleReviewSubmitReportItem" emails="{$my_email},martha.munezhi@torontomu.ca,anna.triandafyllidou@torontomu.ca,bagheri@torontomu.ca" />
    </ReportSection>
</Report>
