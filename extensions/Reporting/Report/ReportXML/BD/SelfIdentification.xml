<?xml version="1.0" encoding="UTF-8" ?>
<Report name="Bridging Divides Diversity Self-Identification Survey" reportType="RP_SELF_IDENTIFICATION" year="0" ajax="true" encrypt="true">
    <Permissions>
        <Role role="LoggedOut">
            <SectionPermission id="form" permissions="rw" />
        </Role>
    </Permissions>
    <!-- Personal Information -->
    <ReportSection id="form" type="EditableReportSection" blobSection="FORM" name="Self-Identification" title="Bridging Divides HQP Self-Identification Survey" showProgress="true" saveText="Submit">
        <If if="{or({==({GET(candidate)},)},{!({isValidUserId({GET(candidate)})})})}">
            <![CDATA[
                You must specify a valid id
            ]]>
        </If>
        <Else>
            <ReportItemSet type="PersonReportItemSet" userId="{decrypt({GET(candidate)})}">
                <!-- Skipped -->
                <If if="{and({==({getText(RP_SELF_IDENTIFICATION,FORM,SKIP,0,{$user_id},0)},SKIP)},
                             {>=({getText(RP_SELF_IDENTIFICATION,FORM,SUBMITTED,0,{$user_id},0)},{subtract({substr({timestamp(Y-m-d)},0,4)},1)}{timestamp(-m-d)})})}">
                    <![CDATA[
                        Thank you for submitting the self identification survey.
                        <script type='text/javascript'>
                            $(document).ready(function(){
                                $('#reportFooter').hide();
                                $('#reportFooter').prev().hide();
                            });
                        </script>
                    ]]>
                </If>
                <!-- Submitted -->
                <ElseIf if="{and({!=({getText(RP_SELF_IDENTIFICATION,FORM,AGE,0,{$user_id},0)},)},
                                 {!=({getText(RP_SELF_IDENTIFICATION,FORM,GENDER,0,{$user_id},0)},)},
                                 {!=({getText(RP_SELF_IDENTIFICATION,FORM,SEX,0,{$user_id},0)},)},
                                 {!=({getText(RP_SELF_IDENTIFICATION,FORM,IDENTITY,0,{$user_id},0)},)},
                                 {!=({getText(RP_SELF_IDENTIFICATION,FORM,MINORITY,0,{$user_id},0)},)},
                                 {!=({getText(RP_SELF_IDENTIFICATION,FORM,RACE,0,{$user_id},0)},)},
                                 {!=({getText(RP_SELF_IDENTIFICATION,FORM,IMMIGRANT,0,{$user_id},0)},)},
                                 {!=({getText(RP_SELF_IDENTIFICATION,FORM,DISABILITIES,0,{$user_id},0)},)},
                                 {!=({getText(RP_SELF_IDENTIFICATION,FORM,LANGUAGE,0,{$user_id},0)},)},
                                 {!=({getText(RP_SELF_IDENTIFICATION,FORM,EDUCATION,0,{$user_id},0)},)},
                                 {>=({getText(RP_SELF_IDENTIFICATION,FORM,SUBMITTED,0,{$user_id},0)},{subtract({substr({timestamp(Y-m-d)},0,4)},1)}{timestamp(-m-d)})})}">
                    <![CDATA[
                        Thank you for submitting the self identification survey.
                        <script type='text/javascript'>
                            $(document).ready(function(){
                                $('#reportFooter').hide();
                                $('#reportFooter').prev().hide();
                            });
                        </script>
                    ]]>
                </ElseIf>
                <Else>
                    <!-- Not Submitted -->
                    <ReportItem id="skip" type="Hidden" blobItem="SKIP" personId="{$user_id}" optional="true" encrypt="true">
                        <![CDATA[
                            <div id='skip'>{$item}</div>
                            <button id='skipButton' type='button'>I don't want to submit this information</button>
                            <script type='text/javascript'>
                                $('#skipButton').click(function(){
                                    $('#skip input').val('SKIP');
                                    updateSnapshot();
                                    saveAll(function(){
                                        window.location.reload(false);
                                    });
                                });
                            </script>
                        ]]>
                    </ReportItem>
                    <Static>
                        <![CDATA[
                            <p>Please read each question carefully and check the response that you feel best applies to you. You have the option to select “Prefer not to answer” for each question. To protect your privacy, you won't be able to edit your responses using the unique link once you have completed the survey. If you need assistance, please contact <a href='mailto:bridging.divides@torontomu.ca'>bridging.divides@torontomu.ca</a>.</p>
                        ]]>
                    </Static>
                    <ReportItem id="age" type="Integer" blobItem="AGE" personId="{$user_id}" min="1900" max="YEAR" width="2.3em" encrypt="true">
                        <![CDATA[
                            <h3>1. Age</h3>
                            <p>What is your year of birth?</p>
                            {$item}
                        ]]>
                    </ReportItem>
                    <ReportItem id="gender" type="Radio" blobItem="GENDER" personId="{$user_id}" options="Gender fluid|Non-binary|Two-spirit|Trans man|Trans woman|Man|Woman|I do not identify with any option|Prefer not to answer" encrypt="true">
                        <![CDATA[
                            <h3>2. Gender</h3>
                            <p>What gender best describes your current gender identity?</p>
                            {$item}
                        ]]>
                    </ReportItem>
                    <ReportItem id="sex" type="Radio" blobItem="SEX" personId="{$user_id}" options="Asexual|Bisexual|Pansexual|Heterosexual|Two-spirit|Gay|Lesbian|Queer|I do not identify with the options provided|Prefer not to answer" encrypt="true">
                        <![CDATA[
                            <h3>3. Sexual orientation</h3>
                            <p>What sexual orientation best describes how you currently think of yourself?</p>
                            {$item}
                        ]]>
                    </ReportItem>
                    <ReportItem id="identity" type="Radio" blobItem="IDENTITY" personId="{$user_id}" options="Yes|No|Prefer not to answer" encrypt="true">
                        <![CDATA[
                            <h3>4. Indigenous identity</h3>
                            <p>Do you self-identify as Indigenous, that is, First Nations (North American Indian), Métis, or Inuk (Inuit)?</p>
                            {$item}
                        ]]>
                    </ReportItem>
                    <ReportItem id="clan" type="Text" blobItem="CLAN" personId="{$user_id}" options="Yes|No|Prefer not to answer" optional="true" encrypt="true">
                        <![CDATA[
                            <p>If yes, what is your family, clan, band, or nation?</p>
                            {$item}
                        ]]>
                    </ReportItem>
                    <ReportItem id="minority" type="Radio" blobItem="MINORITY" personId="{$user_id}" options="Yes|No|Prefer not to answer" encrypt="true">
                        <![CDATA[
                            <h3>5. Visible minority/Racialized individual</h3>
                            <p><i>The <a href='https://laws-lois.justice.gc.ca/eng/acts/E-5.401/?wbdisable=false' target='_blank'>Employment Equity Act</a> defines visible minorities as "persons, other than Aboriginal peoples, who are non-Caucasian in race or non-white in colour."</i><br /> 
    Do you self-identify as a racialized individual (member of a visible minority) in Canada?</p>
                            {$item}
                        ]]>
                    </ReportItem>
                    <ReportItem id="race" type="Radio" blobItem="RACE" personId="{$user_id}" options="Black|East Asian|Indigenous|Latin American|South Asian|Southeast Asian|West Asian|White|Population group not listed/Other|Prefer not to answer" descriptions="African, Afro-Caribbean, African-Canadian, Afro-Latin American|Chinese, Korean, Japanese, Taiwanese|First Nations, Métis, Inuit|Latin American, Hispanic descent|Indian, Pakistani, Sri Lankan, Indo-Caribbean|Filipino, Vietnamese, Cambodian, Thai|Arab, Persian (e.g., Iranian), Afghan|European (English, Scottish, Irish, French, German, Dutch)&lt;br />American, Canadian&lt;br />Oceania (Australian, New Zealander)||" encrypt="true">
                        <![CDATA[
                            <h3>6. Race or population group</h3>
                            <p>What race or population group do you identify with most?</p>
                            <div id='race'>{$item}</div>
                            <script type='text/javascript'>
                                $('div#race table').prepend("<tr><th>Race or population group</th><th>Description and <u>select</u> examples</th></tr>");
                            </script>
                        ]]>
                    </ReportItem>
                    <ReportItem id="immigrant" type="Radio" blobItem="IMMIGRANT" personId="{$user_id}" options="Yes|No|Prefer not to answer" encrypt="true">
                        <![CDATA[
                            <h3>7. Citizenship status</h3>
                            <p>Are you an immigrant?</p>
                            {$item}
                        ]]>
                    </ReportItem>
                    <ReportItem id="country" type="Text" blobItem="COUNTRY" personId="{$user_id}" optional="true" encrypt="true">
                        <![CDATA[
                            <p>If you are an immigrant, what is your country of origin?</p>
                            {$item}
                        ]]>
                    </ReportItem>
                    <ReportItem id="disabilities" type="Radio" blobItem="DISABILITIES" personId="{$user_id}" options="Yes|No|Prefer not to answer" encrypt="true">
                        <![CDATA[
                            <h3>8. Disabilities</h3>
                            <p><i>The <a href='https://laws-lois.justice.gc.ca/eng/acts/A-0.6/' target='_blank'>Accessible Canada Act</a> defines disability as “any impairment, including a physical, mental, intellectual, cognitive, learning, communication or sensory impairment—or a functional limitation—whether permanent, temporary or episodic in nature or evident or not, that, in interaction with a barrier, hinders a person’s full and equal participation in society.”</i><br />
    Do you consider yourself to be a person with a disability as described in the Act?</p>
                            {$item}
                        ]]>
                    </ReportItem>
                    <ReportItem id="language" type="Radio" blobItem="LANGUAGE" personId="{$user_id}" options="English|French|Another language|Prefer not to answer" labels="English|French|Another language:|Prefer not to answer" encrypt="true">
                        <![CDATA[
                            <h3>9. Language</h3>
                            <p>What language(s) did you first learn at home in childhood and still understand?</p>
                            <div id='language' style='position: relative;'>
                                {$item}
                        ]]>
                    </ReportItem>
                    <ReportItem id="language_other" type="Text" blobItem="LANGUAGE_OTHER" personId="{$user_id}" optional="true" encrypt="true">
                        <![CDATA[
                                <div id='language_other' style='position: absolute; left: 10.5em; top: 3.4em;'>{$item}</div>
                            </div>
                        ]]>
                    </ReportItem>
                    <ReportItem id="education" type="Radio" blobItem="EDUCATION" personId="{$user_id}" options="Yes|No|Prefer not to answer" encrypt="true">
                        <![CDATA[
                            <h3>10. University education</h3>
                            <p>Are you the first person or first generation in your family to attend university and/or attain a university degree?</p>
                            {$item}
                        ]]>
                    </ReportItem>
                    <ReportItem id="submitted" type="Hidden" blobItem="SUBMITTED" personId="{$user_id}" optional="true">
                        <![CDATA[
                            <div id='submitted'>{$item}</div>
                        ]]>
                    </ReportItem>
                    <ReportItem id="snapshot" type="Hidden" blobItem="SNAPSHOT" blobSubItem="{timestamp(Y-m)}" personId="{$user_id}" encrypt="true" optional="true">
                        <![CDATA[
                            <div id='snapshot'>{$item}</div>
                        ]]>
                    </ReportItem>
                    <Static>
                        <![CDATA[
                            <script type='text/javascript'>
                                
                                function updateSnapshot(){
                                    $('#submitted input').val(new Date().toISOString().slice(0, 10));
                                    var data = {};
                                    _.each($("#reportMain form").serializeArray(), function(el){
                                        var id = el.name.split('extra0_').at(-1);
                                        if(id != 'snapshot'){
                                            data[el.name.split('extra0_').at(-1)] = el.value;
                                        }
                                    });
                                    $('#snapshot input').val(JSON.stringify(data));
                                }
                                
                                $(document).ready(function(){
                                    $('button[value=Save]').click(function(){
                                        var percent = $("#reportProgressBar").attr("data-percent");
                                        if(percent == 100){
                                            updateSnapshot();
                                            alert('Thank you for submitting the self identification survey.');
                                            saveAll(function(){
                                                window.location.reload(false);
                                            });
                                        }
                                        else{
                                            alert('Please answer all required questions.');
                                        }
                                    });
                                });
                            </script>
                        ]]>
                    </Static>
                </Else>
            </ReportItemSet>
        </Else>
    </ReportSection>
</Report>
